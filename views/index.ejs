<!DOCTYPE html>
<html ng-app="carbonCalc">
<head>
  <meta charset="utf-8"/>
  <title>Carbon Calculator</title>
  <script type="text/javascript" src="scripts/libs/angular.min.js"></script>
  <script type="text/javascript" src="scripts/libs/jquery-3.1.1.min.js"></script>

  <link rel="stylesheet" type="text/css" href="css/style.css">
  <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
</head>

<body ng-app="carbonCalc" ng-controller="mainController">

  <div class="container">

  <h1>Carbon Calculator</h1><br>

    <h2>Step 1: Build the Model</h2>
    <div class="btn-group">
      <button type="button" class="btn btn-primary" id="btnForm">Form View</button>
      <button type="button" class="btn btn-primary" id="btnCode">Code View</button>
    </div>

    <div class="row">
      <!--- ========= Form View ========= -->
      <div class="col-sm-8 formView" id="formView">
        <form name="build" autocomplete="off">

          <h3>Model Name:</h3>
          <input type="text" name="modelName" ng-model="modelName" ng-blur="addModelName(modelName)" required></li>

          <!-- Objectives -->
          <h3>Objectives</h3>
          <table class="table-bordered">
            <tbody>
              <tr>
                <th>Objectives</th>
                <td ng-repeat="o in objectives">{{o.name}}</td>
                <td>
                  <input type="text" ng-model="inputobj" ng-blur="addObj(inputobj)"
                    ng-keydown="$event.which === 13 && addObj(inputobj)" ng-required="objectives.length==0">
                </td>
              </tr>
              <tr>
                <th>ENB</th>
                <td ng-repeat="o in objectives">{{o.enb}}</td>
              </tr>
              <tr>
                <th>LP</th>
                <td ng-repeat="o in objectives">{{o.lp}}</td>
              </tr>
              <tr>
                <th>NB</th>
                <td ng-repeat="o in objectives">
                  <input type="text" ng-model="o.nb" ng-blur="addNB(o,o.nb)"
                    ng-keydown="$event.which === 13 && addNB(o,o.nb)" required>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Variables -->
          <h3>Variables</h3>
          <table class="table-bordered">
            <thead>
              <tr>
                <th>Variable</th>
                <th ng-repeat="vo in varoptions">{{vo}}?</th>
              </tr>
            </thead>
            <tbody>
              <tr ng-repeat="v in variables">
                <th>{{v}}</th>
                <td ng-repeat="vo in varoptions">
                  <input type="checkbox" ng-model="vo[option]">
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Parameters -->
          <table>
            <tbody>
              <tr ng-repeat="p in parameters">
                <th>{{p.name}}</th>
                <td>
                  <input type="text" ng-model="p.value" ng-blur="saveParameter(p,p.value)"
                  ng-keydown="$event.which === 13 && saveParameter(p,p.value)" required>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Equations -->
          <table>
            <tbody>
              <tr ng-repeat="e in equations">
                <th>{{e.name}}</th>
                <td>
                  <input type="text" ng-model="e.value" ng-blur="saveEquation(e,e.value)"
                    ng-keydown="$event.which === 13 && saveEquation(e,e.value)" required>
                </td>
              </tr>
            </tbody>
          </table>

          <!-- Decisions -->
          <table>
            <tbody>
              <tr ng-repeat="d in decisions">
                <th>{{d.name}}</th>
                <td></td>
                <td>
                  <!-- <input type="text" ng-model="e.value" ng-blur="saveEquation(d,d.value)"
                    ng-keydown="$event.which === 13 && saveEquation(e,e.value)" required> -->
                </td>
              </tr>
            </tbody>
          </table>

          <h3>Parameters:</h3>
          <ul>
            <div ng-repeat="param in params">
              <li>
                {{param.name}} =
                <input type="text" name="paramVal" ng-model="paramVal" ng-blur="saveParamVal(param,paramVal)"
                  ng-keydown="$event.which === 13 && saveParamVal(param,paramVal)" required>
                <span class="glyphicon glyphicon-remove" ng-click="delParamVal(param)"></span>
                <span class="glyphicon glyphicon-unchecked" ng-click="isDecision(param)">Decision?</span>
              </li>
            </div>
          </ul>

          <h3>Decisions:</h3>
          <ul>
            <div ng-repeat="decision in decisions">
              <li>
                {{decision.name}} = decision("<input type="text" value="{{decision.label}}" ng-model="decision.label" ng-blur="saveDecLabel(decision, decision.label)"
                  ng-keydown="$event.which === 13 && saveDecLabel(decision, decision.label)" required>") {
                  <ul>
                    <div ng-repeat="p in decision.policies">
                      <li>
                        "{{p.name}}" :
                        <input type="text" value="{{p.value}}" ng-model="p.value" ng-blur="savePolicy(decision, p, p.value)"
                          ng-keydown="$event.which === 13 && savePolicy(decision, p, policyValue)" required>
                        <span class="glyphicon glyphicon-remove" ng-click="delPolicy(decision,p)">
                      </li>
                    </div>
                    <li>
                      <input class="smaller" type="text" ng-model="newPolicyName" ng-blur="addPolicy(decision,newPolicyName,newPolicyValue)"
                        ng-keydown="$event.which === 13 && addPolicy(decision,newPolicyName,newPolicyValue)" ng-required="decision.policies.length==0"> :
                      <input class="smaller" type="text" ng-model="newPolicyValue" ng-blur="addPolicy(decision,newPolicyName,newPolicyValue)"
                        ng-keydown="$event.which === 13 && addPolicy(decision,newPolicyName,newPolicyValue)" ng-required="decision.policies.length==0">
                        <span class="glyphicon glyphicon-ok" ng-click="addPolicy(decision,newPolicyName,newPolicyValue)">
                    </li>
                  </ul>
                }
                <span class="glyphicon glyphicon-unchecked" ng-click="isParam(decision)">Param?</span>
              </li>
            </div>
          </ul>

          <button type="button" class="btn btn-default" ng-click="saveModel()">Save Model</button>
          <button type="button" class="btn btn-default" ng-click="submitModel(build.$valid,'build','parse')">Parse Model</button>
          <button type="button" class="btn btn-default" ng-click="submitModel(build.$valid,'build','solve')">Solve Model</button>
          <div id="submitButton" class="alert alert-warning alert-dismissable" ng-hide="submitOnInvalid" dismiss-on-timeout="5000">
            <strong>Invalid form: </strong> Please fill in missing value(s).
          </div>
          <div id="successParse" class="alert alert-success alert-dismissable" ng-show="successParse" dismiss-on-timeout="5000">
            Model parsed successfully.
          </div>
        </form>
      </div>

      <!--- ========= Code View ========= -->

      <div class="col-sm-8" id="codeView">
        <form class="" name="upload">
          <h3>Upload Model</h3>
          <div class="row-align">
            <input type="file" id="fileinput" name="model_upload" accept=".rdr" ng-model="uploadFileData">
            <input type="button" value="Upload" ng-click="uploadModel(event)">
          </div>
          <div id="editor" ng-model="uploadedModel"></div>
        </form>
        <button type="button" class="btn btn-default" ng-click="saveModel()">Save Model</button>
        <button type="button" class="btn btn-default" ng-click="submitModel(upload.$valid,'upload','parse')">Parse Model</button>
        <button type="button" class="btn btn-default" ng-click="submitModel(upload.$valid,'upload','solve')">Solve Model</button>
      </div>

      <!--- ========= Helper Column ========= -->

      <!-- <iframe class="googlesheet" src="https://docs.google.com/spreadsheets/d/1E9Rrh-ocXE18_huXiazzTnvBur6Gr7C62S7uDrcdRVY/edit?usp=sharing"></iframe> -->

      <div class="col-sm-4">
        <h3>How To</h3>
        <ul>
          <div ng-repeat="i in instructions">
            <li>{{i.head}}: {{i.body}}</li>
          </div>
        </ul>
        <br></br>
        <h3>Cheat Sheet</h3>
        <span id="cheatSheet">
          <ul>
            <li>ENB = Expected Net Benefit</li>
            <li>NB = Net Benefit</li>
            <li>Current* = represents the state of * as of now</li>
            <li>New* = represents the state of * with new decision</li>
          </ul>
        </span>
      </div>


    </div>

    <h2>Step 2: Results</h2>
    <div class="row">
      <div class="col-sm-6">
        <div id="model_graph"></div>
        <div class="model_filter">
          <table>
              <tr>
                <!-- <div class="inlinediv" > -->
                <td ng-repeat="f in filterable">
                  <label>{{f.name}}:</label>
                  <select ng-model="filterSelect[f.name]" ng-options="value for value in f.values" ng-change="filterOutput()">
                    <option value=""></option>
                  </select>
                </td>
                <!-- </div> -->
              </tr>
          </table>
        </div>
        <div id="model_result"></div>
      </div>
    </div>

  </div>

  <script type="text/javascript" src="scripts/libs/d3.min.js"></script>
  <script type="text/javascript" src="scripts/app.js"></script>
  <script type="text/javascript" src="scripts/helper.js"></script>
  <script type="text/javascript" src="scripts/libs/src-min-noconflict/ace.js" charset="utf-8"></script>
  <script type="text/javascript" src="scripts/index.js"></script>
  <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script> -->
</body>
</html>
